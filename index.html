<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (keep existing head content) ... -->
</head>
<body>
    <!-- ... (keep existing HTML structure) ... -->
    
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
    <script>
        // Improved Wallet Connection
        let currentAccount = null;
        
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                    handleAccountsChanged(accounts);
                    
                    // Set up event listener for account changes
                    ethereum.on('accountsChanged', handleAccountsChanged);
                    
                    return accounts[0];
                } catch (error) {
                    console.error("Error connecting wallet:", error);
                    alert("Error connecting wallet: " + error.message);
                }
            } else {
                alert('Please install MetaMask or another Ethereum wallet!');
            }
        }
        
        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                console.log("Please connect to MetaMask.");
                document.getElementById('connectWallet').style.display = 'block';
                document.getElementById('walletAddress').style.display = 'none';
            } else if (accounts[0] !== currentAccount) {
                currentAccount = accounts[0];
                const shortenedAddress = `${currentAccount.substring(0, 4)}...${currentAccount.substring(38)}`;
                document.getElementById('connectWallet').style.display = 'none';
                document.getElementById('walletAddress').textContent = shortenedAddress;
                document.getElementById('walletAddress').style.display = 'block';
                
                // Update mint button state
                document.getElementById('mintButton').disabled = false;
            }
        }
        
        // Real Minting Function
        async function mintNFT() {
            const mintButton = document.getElementById('mintButton');
            mintButton.disabled = true;
            mintButton.innerHTML = '<span class="loading-spinner"></span> Minting...';
            
            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                
                // Replace with your actual contract details
                const contractABI = [
                    "function mint(uint256 quantity) external payable",
                    "function totalSupply() external view returns (uint256)",
                    "function MAX_SUPPLY() external view returns (uint256)"
                ];
                const contractAddress = "0x123..."; // Your contract address
                const contract = new ethers.Contract(contractAddress, contractABI, signer);
                
                // Get current supply
                const totalSupply = await contract.totalSupply();
                const maxSupply = await contract.MAX_SUPPLY();
                updateMintProgress(totalSupply, maxSupply);
                
                // Execute mint
                const tx = await contract.mint(1, {
                    value: ethers.utils.parseEther("0.00044")
                });
                
                // Wait for transaction confirmation
                await tx.wait();
                
                // Success feedback
                mintButton.textContent = "Minted!";
                mintButton.classList.add('mint-success');
                setTimeout(() => {
                    mintButton.classList.remove('mint-success');
                    mintButton.textContent = "MINT NOW";
                    mintButton.disabled = false;
                }, 3000);
                
                // Update supply after mint
                const newSupply = await contract.totalSupply();
                updateMintProgress(newSupply, maxSupply);
                
            } catch (error) {
                console.error("Minting error:", error);
                alert("Minting failed: " + (error.message || error));
                mintButton.innerHTML = "MINT NOW";
                mintButton.disabled = false;
            }
        }
        
        function updateMintProgress(supply, maxSupply) {
            const percentage = (supply / maxSupply) * 100;
            document.querySelector('.progress-bar').style.width = `${percentage}%`;
            document.querySelector('.mint-stats span:first-child').textContent = `${Math.round(percentage)}% Minted`;
            document.querySelector('.mint-stats span:last-child').textContent = `${supply}/${maxSupply}`;
        }
        
        // Initialize
        document.getElementById('connectWallet').addEventListener('click', connectWallet);
        document.getElementById('mintButton').addEventListener('click', mintNFT);
        document.getElementById('mintButton').disabled = true;
        
        // Check if wallet is already connected
        if (typeof window.ethereum !== 'undefined') {
            ethereum.request({ method: 'eth_accounts' })
                .then(handleAccountsChanged)
                .catch(console.error);
        }
        
        // Particles animation (keep existing)
        // ...
    </script>
</body>
</html>