<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT Mint Mini App</title>
    <!-- Farcaster Frame Metadata -->
    <meta property="fc:frame" content='{"version":"vNext","image":"https://yourdomain.com/preview-image.png","buttons":[{"action":"mint","label":"Mint NFT"}]}' />
    <meta property="og:image" content="https://yourdomain.com/preview-image.png" />
    <style>
        /* تمام استایل‌های قبلی را اینجا حفظ کنید */
        /* ... */
    </style>
</head>
<body>
    <!-- تمام HTML قبلی را اینجا حفظ کنید -->
    <!-- ... -->

    <script type="module">
        // Load Farcaster SDK
        import { sdk } from 'https://esm.sh/@farcaster/frame-sdk';
        
        // Initialize when SDK is ready
        async function initializeApp() {
            try {
                // Hide splash screen
                await sdk.actions.ready();
                
                // Setup wallet connection
                const connectWallet = document.getElementById('connectWallet');
                const walletAddress = document.getElementById('walletAddress');
                
                connectWallet.addEventListener('click', async () => {
                    try {
                        // Request accounts from Farcaster wallet
                        const accounts = await sdk.wallet.ethProvider.request({ 
                            method: 'eth_requestAccounts' 
                        });
                        
                        if (accounts.length > 0) {
                            const address = accounts[0];
                            walletAddress.textContent = `${address.slice(0, 6)}...${address.slice(-4)}`;
                            connectWallet.style.display = 'none';
                            walletAddress.style.display = 'block';
                        }
                    } catch (error) {
                        console.error('Wallet connection error:', error);
                    }
                });

                // Setup mint function
                const mintButton = document.getElementById('mintButton');
                mintButton.addEventListener('click', async () => {
                    if (!walletAddress.textContent) {
                        alert('Please connect your wallet first!');
                        return;
                    }

                    mintButton.disabled = true;
                    mintButton.textContent = "Minting...";

                    try {
                        // Mint transaction
                        const txHash = await sdk.wallet.ethProvider.request({
                            method: 'eth_sendTransaction',
                            params: [{
                                to: '0xYOUR_NFT_CONTRACT_ADDRESS',
                                value: '0x' + (0.00044 * 1e18).toString(16), // 0.00044 ETH in wei
                                data: '0xYOUR_MINT_FUNCTION_DATA'
                            }]
                        });

                        // Success - share to feed
                        await sdk.actions.composeCast({
                            text: "Just minted my NFT! #NFT #Farcaster",
                            embeds: [`https://yourdomain.com/nft/44`]
                        });
                        
                        alert(`NFT minted! TX: ${txHash}`);
                    } catch (error) {
                        console.error('Minting error:', error);
                        alert('Minting failed: ' + error.message);
                    } finally {
                        mintButton.disabled = false;
                        mintButton.textContent = "MINT NOW";
                    }
                });

            } catch (error) {
                console.error('Initialization error:', error);
            }
        }

        // Start the app
        initializeApp();
    </script>
</body>
</html>